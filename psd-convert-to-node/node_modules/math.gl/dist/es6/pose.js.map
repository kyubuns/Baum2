{"version":3,"sources":["../../src/pose.js"],"names":["Matrix4","Vector3","Euler","Pose","constructor","x","y","z","roll","pitch","yaw","position","orientation","Array","isArray","length","RollPitchYaw","value","getPosition","getOrientation","equals","pose","exactEquals","getTransformationMatrix","sr","Math","sin","sp","sw","cr","cos","cp","cw","matrix","setRowMajor","getTransformationMatrixFromPose","multiplyRight","invert","getTransformationMatrixToPose"],"mappings":"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","sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport Matrix4 from './matrix4';\nimport Vector3 from './vector3';\nimport Euler from './euler';\n\nexport default class Pose {\n  /**\n   * A pose contains both rotation and rotations.\n   * Note that every single pose defines its own coordinate system\n   * (with the position of the pose in the origin, and zero rotations).\n   * These \"pose relative\" coordinate will be centered on the defining\n   * pose's position and with with the defining pose's orientation\n   * aligned with axis.\n   */\n  constructor({x = 0, y = 0, z = 0, roll = 0, pitch = 0, yaw = 0, position, orientation}) {\n    if (Array.isArray(position) && position.length === 3) {\n      this.position = new Vector3(position);\n    } else {\n      this.position = new Vector3(x, y, z);\n    }\n    if (Array.isArray(orientation) && orientation.length === 4) {\n      this.orientation = new Euler(orientation, orientation[3]);\n    } else {\n      this.orientation = new Euler(roll, pitch, yaw, Euler.RollPitchYaw);\n    }\n  }\n\n  /* eslint-disable no-multi-spaces, brace-style, no-return-assign */\n  get x() {\n    return this.position.x;\n  }\n  set x(value) {\n    return (this.position.x = value);\n  }\n  get y() {\n    return this.position.y;\n  }\n  set y(value) {\n    return (this.position.y = value);\n  }\n  get z() {\n    return this.position.z;\n  }\n  set z(value) {\n    return (this.position.z = value);\n  }\n  get roll() {\n    return this.orientation.roll;\n  }\n  set roll(value) {\n    return (this.orientation.roll = value);\n  }\n  get pitch() {\n    return this.orientation.pitch;\n  }\n  set pitch(value) {\n    return (this.orientation.pitch = value);\n  }\n  get yaw() {\n    return this.orientation.yaw;\n  }\n  set yaw(value) {\n    return (this.orientation.yaw = value);\n  }\n  /* eslint-enable no-multi-spaces, brace-style, no-return-assign */\n\n  getPosition() {\n    return this.position;\n  }\n\n  getOrientation() {\n    return this.orientation;\n  }\n\n  equals(pose) {\n    if (!pose) {\n      return false;\n    }\n    return this.position.equals(pose.position) && this.orientation.equals(pose.orientation);\n  }\n\n  exactEquals(pose) {\n    if (!pose) {\n      return false;\n    }\n    return (\n      this.position.exactEquals(pose.position) && this.orientation.exactEquals(pose.orientation)\n    );\n  }\n\n  /*\n   * Returns a 4x4 matrix that transforms a coordinates (in the same\n   * coordinate system as this pose) into the \"pose-relative\" coordinate\n   * system defined by this pose.\n   * The pose relative coordinates with have origin in the position of this\n   * pose, and axis will be aligned with the rotation of this pose.\n   */\n  getTransformationMatrix() {\n    // setup precomputations for the sin/cos of the angles\n    const sr = Math.sin(this.roll);\n    const sp = Math.sin(this.pitch);\n    const sw = Math.sin(this.yaw);\n\n    const cr = Math.cos(this.roll);\n    const cp = Math.cos(this.pitch);\n    const cw = Math.cos(this.yaw);\n\n    const matrix = new Matrix4().setRowMajor(\n      cw * cp, // 0,0\n      -sw * cr + cw * sp * sr, // 0,1\n      sw * sr + cw * sp * cr, // 0,2\n      this.x, // 0,3\n\n      sw * cp, // 1,0\n      cw * cr + sw * sp * sr, // 1,1\n      -cw * sr + sw * sp * cr, // 1,2\n      this.y, // 1,3\n\n      -sp, // 2,0\n      cp * sr, // 2,1\n      cp * cr, // 2,2\n      this.z, // 2,3\n\n      0,\n      0,\n      0,\n      1\n    );\n\n    return matrix;\n  }\n\n  /*\n   * Given a second pose that represent the same object in a second coordinate\n   * system, this method returns a 4x4 matrix that transforms coordinates in the\n   * second coordinate system into the coordinate system of this pose.\n   */\n  getTransformationMatrixFromPose(pose) {\n    return new Matrix4()\n      .multiplyRight(this.getTransformationMatrix())\n      .multiplyRight(pose.getTransformationMatrix().invert());\n  }\n\n  /*\n   * Given a second pose that represent the same object in a second coordinate\n   * system, this method returns a 4x4 matrix that transforms coordinates in the\n   * coordinate system of this pose into the coordinate system of the second pose.\n   *\n   * Note: This method returns the inverse of that returned by\n   * this.getTransformationMatrixFromPose(pose)\n   */\n  getTransformationMatrixToPose(pose) {\n    return new Matrix4()\n      .multiplyRight(pose.getTransformationMatrix())\n      .multiplyRight(this.getTransformationMatrix().invert());\n  }\n}\n"],"file":"pose.js"}